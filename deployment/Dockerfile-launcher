FROM rust:1.86-slim-bookworm@sha256:a044f7ab9a762f95be2ee7eb2c49e4d4a4ec60011210de9f7da01d552cae3a55

# Install packages with exact versions for reproducibility
RUN apt-get update -y && \
    apt-get install -y --no-install-recommends \
        docker.io=20.10.24+dfsg1-1+deb12u1+b2 \
        docker-compose=1.29.2-3 \
        curl=7.88.1-10+deb12u14 \
        jq=1.6-2.1+deb12u1 \
        bash=5.2.15-2+b9 \
        coreutils=9.1-1 \
        python3=3.11.2-1+b1 && \
    rm -rf /var/lib/apt/lists/* && \
    rm -rf /var/log/* /var/cache/ldconfig/aux-cache

COPY tee_launcher/launcher.py /scripts/
RUN chmod +x /scripts/launcher.py
ENV PATH="/scripts:${PATH}"
RUN mkdir -p /app-data
RUN mkdir -p /mnt/shared
CMD ["python3", "/scripts/launcher.py"]
