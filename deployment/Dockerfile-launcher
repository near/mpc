FROM debian:bookworm-slim@sha256:acd98e6cfc42813a4db9ca54ed79b6f702830bfc2fa43a2c2e87517371d82edb
ENV DEBIAN_FRONTEND=noninteractive

# Install packages with exact versions for reproducibility
RUN \
    --mount=type=cache,target=/var/cache/apt,sharing=locked \
    --mount=type=cache,target=/var/lib/apt,sharing=locked \
    --mount=type=bind,source=./deployment/repro-sources-list.sh,target=/usr/local/bin/repro-sources-list.sh \
    repro-sources-list.sh && \
    apt-get update && \
    apt-get install -y --no-install-recommends docker.io docker-compose curl jq bash coreutils python3 && \
    : "Clean up for improving reproducibility" && \
    rm -rf /var/log/* /var/cache/ldconfig/aux-cache

COPY --chmod=0755 tee_launcher/launcher.py /scripts/
ENV PATH="/scripts:${PATH}"
RUN mkdir -p /app-data && mkdir -p /mnt/shared
CMD ["python3", "/scripts/launcher.py"]
