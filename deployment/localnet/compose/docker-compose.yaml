# Generated by scripts/localnet/generate-compose.py
services:
  neard:
    image: nearprotocol/nearcore:2.10.5
    container_name: mpc-localnet-neard
    ports:
      - "3030:3030"
    volumes:
      - near-data:/root/.near
      - ../../../deployment/localnet:/seed:ro
    command:
      - /bin/sh
      - -c
      - |
          mkdir -p /root/.near/mpc-localnet
          cp -rf /seed/. /root/.near/mpc-localnet
          neard --home /root/.near/mpc-localnet run
  bootstrap:
    image: mpc-localnet-bootstrap:local
    build:
      context: ../../..
      dockerfile: deployment/Dockerfile-localnet-bootstrap
    depends_on:
      - neard
    volumes:
      - near-data:/root/.near
      - near-credentials:/root/.near-credentials
      - ../../../deployment/localnet:/seed:ro
      - ../../../docs/localnet:/work/docs:ro
      - ../../../scripts:/work/scripts:ro
      - .:/config:ro
      - ../../../target/near:/artifacts:ro
    environment:
      - LOCALNET_CONFIG=/config/localnet.config.json
      - MPC_CONTRACT_PATH=/artifacts/mpc_contract.wasm
    command:
      - /work/scripts/localnet/bootstrap.sh
  mpc-node-1:
    image: mpc-node:latest
    depends_on:
      - neard
    environment:
      - MPC_ENV=mpc-localnet
      - MPC_ACCOUNT_ID=mpc-node-1.test.near
      - MPC_CONTRACT_ID=mpc-contract.test.near
      - MPC_HOME_DIR=/data
      - MPC_SECRET_STORE_KEY=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
      - MPC_IMAGE_HASH=8b40f81f77b8c22d6c777a6e14d307a1d11cb55ab83541fbb8575d02d86a74b0
      - MPC_LATEST_ALLOWED_HASH_FILE=/data/latest_hash.txt
      - MPC_LOCAL_ADDRESS=0.0.0.0
      - NEAR_BOOT_NODES=ed25519:BGa4WiBj43Mr66f9Ehf6swKtR6wZmWuwCsV3s4PSR3nx@neard:24566
      - RUST_LOG=info
    volumes:
      - mpc-node-1-data:/data
    ports:
      - "8081:8080"
      - "3000:3000"
  mpc-node-2:
    image: mpc-node:latest
    depends_on:
      - neard
    environment:
      - MPC_ENV=mpc-localnet
      - MPC_ACCOUNT_ID=mpc-node-2.test.near
      - MPC_CONTRACT_ID=mpc-contract.test.near
      - MPC_HOME_DIR=/data
      - MPC_SECRET_STORE_KEY=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
      - MPC_IMAGE_HASH=8b40f81f77b8c22d6c777a6e14d307a1d11cb55ab83541fbb8575d02d86a74b0
      - MPC_LATEST_ALLOWED_HASH_FILE=/data/latest_hash.txt
      - MPC_LOCAL_ADDRESS=0.0.0.0
      - NEAR_BOOT_NODES=ed25519:BGa4WiBj43Mr66f9Ehf6swKtR6wZmWuwCsV3s4PSR3nx@neard:24566
      - RUST_LOG=info
    volumes:
      - mpc-node-2-data:/data
    ports:
      - "8082:8080"
      - "3001:3000"
volumes:
  near-data:
  near-credentials:
  mpc-node-1-data:
  mpc-node-2-data:
